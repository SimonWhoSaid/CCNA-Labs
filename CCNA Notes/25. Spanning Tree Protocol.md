# Layer 3 Path Selection and Loop Prevention

Network Topology

<img width="481" height="461" alt="image" src="https://github.com/user-attachments/assets/cc0ffc6e-bd13-44d8-860b-34efb280aa37" />

- Layer 3 routing and HSRP control the path selection and provide automatic failover for layer 3 connections

R1 Static Route to SP1 AD of 1
- _ip route 0.0.0.0 0.0.0.0 203.0.113.1_

R1 Backup default static route via R2 AD of 5. In case the route to SP1 fails
- _ip route 0.0.0.0 0.0.0.0 10.10.20.2 5_

R1 interface G0/1 is directly connect to 10.10.10.0/24 AD of 0, because it is a connected route

We will need a backup in case the link from R1 and CD1 goes down.

R1 backup route to 10.10.10.0/24 via R2 AD of 1
- _ip route 10.10.10.0 255.255.255.0 10.10.20.2_

HSRP - Hot Standby Router Protocol

R1
- (config)#_interface 0/1_
- (config-if)#_ip address 10.10.10.2 255.255.255.0_
- (config-if)#_no shutdown_
- (config-if)#_standby 1 ip 10.10.10.1_

R2
- (config)#_interface g0/1_
- (config-if)#_ip address 10.10.10.3 255.255.255.0_
- (config-if)#_no shutdown_
- (config-if)#_standby 1 ip 10.10.10.1_

All the PCs will be using R2 as the active default gateway because of the higher IP address. 10.10.10.3 vs 10.10.10.2

## Routing Loop

- R1(config)#_ip route 10.10.50.0 255.255.255.0 203.0.113.1_
- SP1(config)#_ip route 10.10.50.0 255.255.255.0 203.0.113.10_
- SP2(config)#_ip route 10.10.50.0 255.255.255.0 203.0.113.6_
- R2(config)#_ip route 10.10.50.0 255.255.255.0 10.10.20.1_

Because there is no 10.10.50.0/24 network the routers will be passing this information on to the next hop to look for it. In dynamic routing we have a feature called TTL (time to live) that prevents routing loops. Because after each hop if it can not find the subnet it will subtract from the total of TTL until it reaches 0. Once it reaches 0 the ICMP packet will drop and the traffic stops.


# Why We Have the Spanning Tree Protocol

Because switches deal with broadcast traffic at layer 2, whenever a switch receives an ARP request it will broadcast that traffic through all of its ports except for the port it received the information from. Now in our network topology, since we have multiple switches connected to it, the broadcast traffic will reach all other switches and be in a constant loop with each other. This is called a broadcast storm. Broadcast storms can cause high CPU and high bandwidth which will slow down the network and eventually cause the switches to fail. Because the ethernet header does not have a TTL, the looping will go on forever until we physically unplug the switch itself. STP is protocol that is used to prevent layer 2 loops, it does this by detecting potential loops and blocking ports to prevent loops.

Back to our network topology on Acc3 and Acc4 we have enabled STP on F0/21 and F0/24. This means that these ports are blocked, they can not send or receive any information on those blocked ports. STP automatically detects potential loops in the network and will block those ports. Besides from preventing loops STP also automates failover. So if a link goes down it will automatically turn the blocked port into an active port.

# Spanning Tree - The Bridge

# How Spanning Tree Works

# Spanning Tree Versions

# Verification of Spanning Tree

# Manipulating the Root Bridge Election

# Spanning Tree and HSRP Alignment

# Portfast, BPDU Guard and Root Guard

# BPDU Filter

# Loop Guard

# PVST+ vs RPVST+ Convergence

# RPVST+ and Hub Interoperability
