# Campus LAN Design - Core, Distribution, and Access Layers

- The campus LAN should be designed for scalability, performance, and security
- To aid in a best practice design process, the network topology is split into **Access, Distribution, and Core layers**

In the three tiered architecture we have traffic flows that work from "North to South"

<img width="1071" height="509" alt="image" src="https://github.com/user-attachments/assets/a6de0558-2580-4a27-9206-2b4a2a4ee239" />


### Access Layer
- This is where the end host plugs into. Usually into "Access Switches".
- The access layer is designed to have a high port count at an affordable cost.
- Desktops typically have only one NIC so they connect into one switch or WAP
- Servers will often have dual NICs and connect to a a pair of redundant switches
- Client access security measures are enabled at the access layer
- Access Layer Switches do not connect to each other

### Distribution Layer
- Distribution is in between the core and access layers
- Distribution layer switches server as an aggregation point for the access layer and provide scalability
- Distribution layer switches are typically deployed in redundant pairs, with downstream Access Layer switches connected to both
- End hosts are not typically connected here
- Most software policy such as QoS is enabled at the distribution layer

### Core Layer
- Core Layer switches may be only in one building and link all of the buildings together
- Core Layer switches are typically deployed in redundant pairs, with downstream distribution layer switches connected to both
- Traffic between different parts of the campus travels through the core so is designed for speed and resiliency
- Software policy slows the switch down so it should be avoided in the Core Layer

### Collapsed Distribution and Core Architecture
- Used on smaller campuses that do not need the scalability of three separate layers.
- A Collapsed Distribution and Core, the two layers are combined on the same hardware device.

<img width="780" height="450" alt="image" src="https://github.com/user-attachments/assets/0aa19b9c-e480-47ef-9661-adb84fdc4089" />


# Spine-Leaf Network Design

Traffic flows from "East to West"

- Designed for better scalability and better for east and west traffic flows, because you can always add more "Spine Switches" and "Leaf Switches"
- Servers are connected to the Tier 1 "Leaf Switches" then those switches connect to the "Spine Switches" in mesh topology

<img width="963" height="380" alt="image" src="https://github.com/user-attachments/assets/759bd369-b853-4af0-a924-4b9a85dc105d" />


# Why We Have VLANs

## Router Operations
- Routers operate at Layer 3 the network layer
- Hosts in separate IP subnets must send traffic through a router in order to communicate
- Security rule son routers or firewalls can be used to easily control what traffic is allowed between different IP subnets at Layer 3
- Routers do not forward broadcast traffic by default
- They provide performance and security by splitting networks into smaller domains at Layer 3

## Switch Operations
- Switches operate at Layer 2 the data-link layer
- Switches do forward broadcast traffic by default
- By default a campus switched network is one large broadcast domain
- Switches flood braodcast traffic everywhere, including between different IP subnets and this raises concern for performance and security.


Example LAN
<img width="1045" height="494" alt="image" src="https://github.com/user-attachments/assets/18ac07b5-3e03-4644-ad85-9df67582f3fb" />

- Unicast Traffic sent from PC1 to PC2 will go from PC1 to the switch and to PC2
- Unicast between different IP subnets. PC2 wants to send traffic to ENG PC1. The Switch then sends traffic to the Router, the Router will send the traffic back down to the subnet that it is connected to on the switch, then the switch will send it over to the PC
- <img width="1057" height="580" alt="image" src="https://github.com/user-attachments/assets/1580a442-099d-4c88-8e6c-e87d5bfa4200" />

## Broadcast Traffic.
- If a PC makes an ARP request, the switch will flood all the traffic to every port (except for the port that made the request)
- This a problem because the traffic bypasses router or firewall layer 3 security policies
- It affects performance because every end host has to process the traffic
- It also affects performane by using bandwidth on links where the traffic is not required

## VLANs - Virtual Local Area Networks
- VLANs combat the broadcast address problem because we can segment the LAN into separate broadcast domains at layer 2
- This helps us increase performance and security in the LAN
- Switches will only allow traffic within the same VLAN
- So when a VLAN is giving out broadcast traffic it will only flood ports that are assigned to that VLAN instead of all of the ports associated to that switch. This helps with security and performance.
<img width="1047" height="485" alt="image" src="https://github.com/user-attachments/assets/bef7843e-84b0-4c91-bc4d-5e24d9632156" />

# VLAN Access Ports
- VLAN access ports are configured on siwtch interfaces where end hosts are plugged in
- Access ports are configured with one specific VLAN
- The configuration is all on the switch, the end host is not VLAN aware
- Switches only allow traffic within the same VLAN

## Default VLAN - VLAN1
- All ports are in VLAN 1 by default
- We need to create the VLANs to separate the broadcast domains
- Here is our topology again.
- <img width="1047" height="485" alt="image" src="https://github.com/user-attachments/assets/bef7843e-84b0-4c91-bc4d-5e24d9632156" />

- We will be creating the Engineering VLAN first.
  - In global config we will enter our VLAN Number which will be _vlan 10_
  - Then we will name it in the (config-vlan)# _name Engineering_
  - Then we will enter interface mode of the interface we want to configure. _Interface F0/1_
  - Then _switchport mode access_ to make it an access port
  - _switchport access vlan 10_
  - Drop back down to global config and use _Interface range FastEthernet 0/3 - 5_ This will cover the whole range of ports
  - We will now be in interface mode _Switchport mode access_
  - _Switchport access vlan 10_
 
- Sales VLAN
  - While in global config _Vlan 20_
  - (config-vlan)# _name Sales_
  - (config)#_Interface f0/2_
  - (config-if)#_switchport mode access_
  - (config-if)#_switchport access vlan 20_
  - (config)#_interface range FastEthernet 0/6 - 7_
  - (config-if)#_switchport mode access_
  - (config-if)#_switchport access vlan20_
 
- Then to verify everything use _show vlan brief_
- To verify a single port we do _show interface f0/0 switchport_ in privileged exec mode

# VLAN Trunk Ports
When converting a link to a trunk port it is a method of carrying multiple VLANs over a single physical link.

## 802.1Q Trunks
- An access port carries traffic for one specific VLAN
- 802.1Q trunks are configured on the links between switches where we need to carry traffic for multiple VLANs
- When the switch forwards traffic to another switch, over a trunk port, it tags the layer 2 802.1Q header with the correct VLAN
- The receiving switch will only forward the traffic out ports that are in that VLAN
- The switch removes the 802.1Q tag from the ethernet frame when it sends it to the end host

## Hypervisors - VLAN Aware Hosts
- End hosts are typically members of only one VLAN and are not VLAN aware
- Virtualized Hosts with Virtual switches need to have a trunk port.

## **Trunk Port Configuration**
- (config)#_Interface FastEthernet 0/24_
- (config-interface)#_Description Trunk to SW2_
- (config-interface)#_switchport trunk encapsulation dot1q_
- (config-interface)#_switchport mode trunk_
- (config-interface)#_switchport trunk allowed vlan_
  - We can specify which VLANs we want to add. Either by individual VLANs _switchport trunk allowed vlan 10,20_
  - OR by a range of VLANs _switchport trunk allowed vlan 10-20_

**YOU MUST CONFIGURE THIS ON THE OTHER SWITCH AS WELL**
 
## InterVLAN Routing
- InterVLAN Routing is the process of forwarding traffic between different VLANs. This allows devices in different VLANs to communicate, which would otherwise be blocked at the default Layer 2 level.
<img width="1038" height="576" alt="image" src="https://github.com/user-attachments/assets/a0eaeb77-0a39-466d-9f08-7f3da1d7d9b1" />

- The router has the ability to turn its interface into a trunk link. This helps read the tag on the frame that arrives on the link and as well as add a tag to the frame as it leaves the router.

### InterVLAN Routing Configuration (Router on a stick)
- ON THE SWITCH
  - (config)#_Interface F0/24_
  - (config-if)#_switchport mode trunk_
  - (config-if)#_switchport trunk allowed vlan 10,20_
  - (config-if)#_switchport trunk encapsulation dot1q_

- ON THE ROUTER
  - (config)#_interface f0/0_
  - (config-if)#_no shutdown_
  - (config-if)#_interface f0/0 .10_
  - (config-subif)#_encapsulation dot1q 10_ (the 10 is the VLAN ID) subinterfaces are virtual interfaces on a router.
  - (config-subif)#_ip address 10.0.0.1 255.255.255.0_
  - (config-subif)#_no shutdown_
  - (config-subif)#_int f0/0 .20_
  - (config-subif)#_encapsulation dot1q 20_
  - (config-subif)#_ip address 172.16.0.1 255.255.255.0_
  - (config-subif)#_no shutdown_
  - Exit it out and _copy run start_ to save your changes
  - Confirm changes with _Show Ip Route or Show Ip Interface Brief_

## Voice VLAN Configuration
- (config)#_interface F0/10_
- (config-interface)#_description IP Phone_
- (config-interface)#_switchport mode access_
- (config-interface)#_switchport access vlan 10_
- (config-interface)#_switchport voice vlan 20_

### Allowed VLAN Configuration

This configuration allows only certain VLANs to go over a trunk. In the example down below we do not need to include the 10.10.20.0/24 VLAN over the trunk because there are no other PCs with the same subnet on the other Switch. This is for security reasons and bandwidth.

<img width="948" height="463" alt="image" src="https://github.com/user-attachments/assets/6f91b0f0-d840-48b2-9a20-38f6d2a43aef" />

- (config)#_interface F0/1_
- (config-if)#_switchport trunk allowed vlan 10,30_

## The Native VLAN
- The switch needs to know which VLAN to assign to any traffic which comes in untagged on a trunk port
- This used to be required for when a switch was connected to a hub. Because hubs are layer 1 devices and are not VLAN aware.
- The Native VLAN is used to support hubs.
- The Default native VLAN is VLAN1, which is a security issue because there are some exploits that target this vulnerability.
- Best practice for a Native VLAN is to assign it to a random VLAN

## Native VLAN Configuration
- (config)#_vlan 199_
- (config-vlan)#_name Native_
- (config)#_interface F0/1_
- (config-interface)#_description Trunk to SW1_
- (config-interface)#_switchport trunk encapsulation dot1q_
- (config-interface)#_switchport mode trunk_
- (config-interface)#_switchport trunk native vlan 199_

## Verification of Switchport
- _show interface switchport_
<img width="643" height="397" alt="image" src="https://github.com/user-attachments/assets/67f717ed-0776-498e-b888-eb8a1ada8099" />


## Dynamic Trunk Protocol
- If two Cisco switches are cabled together they can negotiate a trunk connection using Cisco's DTP
- It is however recommended to manual configure switch ports instead of DTP.

# VTP VLAN Trunking Protocol
- VTP helps reduce administration in a switched network because when you configure a new vlan on one VTP server, the VLAN is distributed through all siwtches in the domain. So instead of having to configure every switch, you can configure the VTP server and it will advertise itself with the new VLAN to the clients.
- The VTP allows you to add, edit or delete VLANs on switches configured as VTP servers, and have other switches configured as VTP clients, which can synchronize their VLAN database with each other.
- This can be convenient if you manage a large campus.
- You will still need to perform port level VLAN configuration on switches.
- Be aware of VTP wipeouts
  - Whenever a VLAN is added to the VLAN database, an incrememnt to the revision number on the VTP **SERVER** switch is added. THe server switch then sends out a VTP advertisement with the new revision number to all over switches on the VLAN domain.
  - When a client receives the revision number advertisement it will update their VLAN database to match their new information.
  - IF a higher revision number on a switch is added to the VLAN domain it will advertise itself with the higher number, then all other switches will update their database according to that new switch, which may delete prexisiting VLANs
- You can view VTPs with _show vtp status_
- You can reset the revision number by chaning the VTP domain name and then changing it back to the original name.

## VTP Modes
- VTP server
  - Can add, edit, or delete VLANs. A VTP server will synchronize its VLAN database from another server with a higher revision number
- VTP Client
  - Cannot add, edit, or delete VLANs. A VTP client will synchronize its VLAN database from the server with the highest revision number.
- VTP Transparent
  - Does not participate in the VTP domain. Does not advertise or learn VLAN information but will pass it on.
  - It can add, edit, or delete VLANs in its own local VLAN database
 
## VTP configuration


## Layer 3 Switch

A layer 3 switch is combining the router and switch into a single device. When it comes to configuring a layer 3 switch, you must think of it as having to configure a router and a switch.

- Cisco Layer 2 switch models will begin with the number '2'
  - 2950
  - 2960
 
- Cisco Layer 3 switch models will begin with the number '3'
  - 3560
  - 3750
  - 3850

### Configuration of a layer 3 swtich

### Switched Virtual Interfaces (SVI)
- Switched virtual interface is a virtual interface on the switch.
- This a layer 3 interface, but it does not have a physical port assigned to it.
- SVIs will act like the default gateway for the VLAN
- When we create a VLAN for a layer 3 switch, those VLANs will be layer 3 interfaces, meaning that we can assign IP addresses to those layer 3 interfaces
- We need to configure the layer 2 portion and then configure the layer 3 portion
- BY DEFAULT layer 3 switches operate as a layer 2 switch. We must first configure it to become a layer 3 switch.

- First we will make the switch into a layer 3 device. This will turn on the routing feature of the switch
  - (config)#_ip routing_. This will turn on the routing features, the following steps will be configuring the VLANs
  - (config)#_int vlan 10_
  - (config-if)#_ip address 10.0.0.1 255.255.255.0_
  - (config-if)#_no shutdown_
  - (config)#_int vlan 20_
  - (config-if)#_ip address 172.16.0.1 255.255.255.0_
  - (config-if)#_no shutdown_
  - Layer3Switch#_show ip route_

- In the running config _show run_ if you see the interface listed as a 'switchport' that means that port is a layer 2 port

