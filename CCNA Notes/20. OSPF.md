# OSPF

## OSPF Characteristics
- OSPF is a link state routing protocol
- It supports large networks
- It has very fast convergence time
- MEssages are sent using Multicast
- OSPF is an open standard protocol
- Uses an alogrithm to determine the best path to learned networks

## OSPF vs EIGRP vs RIP
- RIP has scalability limitations so it is not typically used in production netowrks
- Most companies use EIGRP or OSPF for their IGP
- OSPF is the most commonly used
- OSPF has lots of documentation and is an open standard
- EIGRP can be simpler to implement and troubleshoot

## Link State Routing Protocols
- In link state routing protocols, each router describes itself and its interfaces to its directly connected neighbours
- This information is passed unchanged from one router to another
- Every router learns the full picture of the network including every router, its interfaces and what they connect to
- OSPF routers use Link State Advertisements (LSA) to pass on routing updates

## OSPF Operations
1. Discover neighbours
2. Form Adjancies
3. Flood Link State Database (LSDB)
4. Compute Shortest Path
5. Install Best Routes in Routing Table
6. Respond to Network Changes

## OSPF Packet Types
- Hello Packets: A router will send out and listen for hello packets when OSPF is enabled on an interface, and form adjancencies with other OSPF rouers on the link
- Database Description (DBD): Then when the router forms an adjancency, adjacent routers will tell each other the networks they know about with the DBD packet
- Link State Request (LSR): If a router is missing information about any of the networks in the received DBD, it will send the neighbour an Link State Request
- Link State Advertisement (LSA): A routing update
- Link State Update (LSU): Contains a list of LSA's which should be updated, used during flooding
- LSAck: Receiving routers acknowledge LSAs

## OSPF Configuration - Process ID
- Must be in global config. _router OSPF 1_
  - The 1 represents the process ID
- Different interfaces on a router can run in different instances of OSPF
- Different instances have different LSDB
- Only one instance is typically configured on OSPF routers - multiple process IDs are very rarely used
- The process ID is locally significant. It does not have to match on the neighbour router to form an adjacency.
  - <img width="898" height="280" alt="image" src="https://github.com/user-attachments/assets/75f5ac23-cdcd-4de6-a4cf-6c2e2c448376" />
  - R2 will still form adjancies with R1 and R3. R1 and R2 will not learn about each other because of different Process IDs

## OSPF Configuration - Network
- Must be in global configuration. _router OSPF 1_ _network 10.0.0.0 0.0.255.255 area 0_
- The network command uses a wildcard mask
- The command does not default to using the classful boundary, you must enter a wildcard mask
- The network command explanation
  - Look for interfaces with an IP address which falls within this wildcard mask
  - Enable OSPF on those interfaces which means - Send out and listen for OSPF hello messages and peerf with adjacent OSPF routers
  - Advertise the network and mask which is configured on those interfaces
  - One thing to note is that wildcard does not target the subnet mask it is pointing to.
    - 0.0.0.255 Wilcard mask will not target a /24 subnet.

## OSPF Verification
_Sh Run | section OSPF_
- This will display the ospf command in the running config

_Show ip ospf interace brief_
- Interace that has OSPF, PID, Area, IP Address/Mask, Cost, State, Neighbors

_Show IP ospf neighbor_
- Shows neighbors attached to the router

_Show IP ospf database_
- Shows links in the area and ths OSPF network

_Show IP Route_
- Double check if you have OSPF routes in the routing table

# OSPF Advanced Topics

## OSPF Router ID
- OSPF Routers identify themselves using an OSPF Router ID which is in the form of an IP address
- This will default to being the highest IP address of any loopback interfaces configured on the router, or the highest other IP address if a loopback does not exist
- Loopback interfaces never go down so the Router ID will nto change
- You can also manually specif the Router ID
- Best practice is to use a loopback or manaully set the Router ID

## OSPF Rotuer ID - No Loopback
<img width="496" height="274" alt="image" src="https://github.com/user-attachments/assets/4173856e-1915-47da-b2d2-319e01e113c7" />

- If there is no loopback address set it will choose the highest IP interface on the router and use that as its Router ID.
- In the example above FE3/0 has an IP address of 10.0.3.1, so when we do a _Show Ip Protocols_ the Router ID for OSPF will be 10.0.3.1

## OSPF Router ID - With Loopback
<img width="519" height="291" alt="image" src="https://github.com/user-attachments/assets/f2a37467-293c-460d-b191-371baacd2464" />

- Since there is a loopback address enabled on the router, the router prefers to use that address as the Router ID instead of the highest IP interface

## OSPF Router ID - Manual Configuration
- In global configuration
  - _Router OSPF 1_
  - _router-id x.x.x.x_
  - end
- _clear ip ospf process_
- Show ip protocols to confirm the router id

## Passive Interface Configurations
- In global configuration
  - _Router OSPF 1_
  - _Passive-interface loopback 0_
  - _Passive-interface [interface]_
  - Then input the network command on the outgoing interface
    - _network [Interface IP] [Wildcardmask] [Area]_
 
Remember passive interfaces are used for advertising a routing protocol to form adjaacencies, but don't want to advertise that subnet out to the network.

## Default Route Injection
- Injecting the OSPF protocol to go out to the internet
- _ip route 0.0.0.0 0.0.0.0 [Internet IP Address]_
- _Router ospf 1_
- _Default-information originate_

To verify it
- _Show Ip Route_
- Double check that OSPF has a route to 0.0.0.0

# OSPF Areas
- Every router learns the full picture of the network including every router, its interfaces, and what they connect to.
- This can casue issues in large networks
  - Too many routers can use up too much router memory
  - Network changes cause all routers to reconverge which takes time and CPU resources
- OSPF supports a hierarchical design which segments large networks into smaller areas to solve this problem
- Each router maintains full information about its own area, but only summary information about other areas
  - So if a new router goes up or down in a different area it only effects that area
 
- A two level hierachy is used
  - Area 0 or Transit area
    - Does not generally contain end users
  - Regular areas
    - Regular areas are used to connect end users to the Transit area. By default, all transit traffic goes through the transit area
- Small networks do not require a hierarchical design and all routers can be in Area 0

## OSPF Configuration - Network
- The area is configured at theinterface level with the _network_ command
- For a router to form an adjacency, its neighbour must be configured to be in the same area, area mismatches will not form adjancies

## OSPF Router Types - Backbone Routers
- Routers which have all their OSPF interfaces in Area 0 are backbone routers
- Routers maintain a full LSDB of other routers and links in their own area

## Internal Routers
- Routers received from other routers in the same area appear as internal OSPF routers

## OSPF Router Types - ABRs
- Area Border Routers
- Routers which have interfaces in multiple areas are ABRs
- ABRs separates LSA flooding zones
- It becomes the primary point for area address summarization
- It funxtions regularly as the source for default routes
- It maintains the LSDB for each area with which it is connected
- The ideal design is to have each ABR connected to two areas only, the backbone and another normal area
- ABRs do not automatically summarize
- If you do not configure summarization, all route are flooded everywhere
- Manual Summarization configuration
  - _Router OSPF 1_
  - _Network 10.1.0.0 0.0.255.255 area 0_
  - _Network 10.0.0.0 0.0.255.255 area 1_
  - _Area 0 range 10.1.0.0 255.255.0.0_
  - _Area 1 range 10.0.0.0 255.255.0.0_
- In this example we have configured the network of the OSPF range and summarization of the two interfaces on the router.
<img width="1019" height="160" alt="image" src="https://github.com/user-attachments/assets/08a98fae-3fe9-49fb-bac6-5fe7b276b12d" />

- Inter Area Routers are routers that are learned by a ABR. They will show up in the routing table.

## OSPF Router Types - Normal Area Router
- Routers which have all their OSPF interfaces in a normal area are normal internal routers
- These Routers will maintain a full LSDB of other routers and links in their own area
- They learn Inter Area Routers to other areas from their ABRs

## OSPF Router Types - ASBRs
- Routers which resdistribute into OSPF are Autonomous System Boundary Routers
- ASBRs means that it is running OSPF, but it is also running another routing protocol.
- Basically importing external routes and redistributing them into our OSPF network
- ASBRs will show up as External routes
  - But not as external traffic but as redistributed traffic

# Badnwidth vs Clock Rate and Speed

## The _Speed_ Command

- The rate that ethernet interfaces physically transmit at is set by the _Speed_ command
- GigabitEthernet interfaces transmit at 1000 Mbps by default
- FastEthernet Interfaces transmit at 100 Mbps by default
- If you use the _Speed 10_ command on a FastEthernet interface it will physically transmit at 10 Mbps

## The _Clock Rate_ Command

- The rate that **Serial** interfaces physically transmit at is set by the _clock rate_ command
- Serial interfaces transmit at 1.544 Mbps by default
- _Clock rate 64000_ command on a serial interface it will physically transmit at 64 Kbps

## The _Bandwidth_ Command

- Interfaces also have a default bandwidth
  - 100 Mbps on FastEthernet
- The bandwidth usually mathces the physical transmission rate of the interface
- The _bandwidth_ setting on an interface does not affect the physical transmission rate - that is set by the _speed_ or _clock rate_
- If you set a bandwidth of 50 Mbps on a FastEthernet interface, it will still transmit at 100Mbps
- The _bandwidth_ command affects software policy on the router, such as which path will be selected by EIGRP or OSPF, or how much bandwidth will be guaranteed to a traffic type by QoS
- You can influence software policy by setting the bandwidth on an interface

# OSPF Cost Metric

- As OSPF is a link state routing protocol, the router will elarn about all destinations in its area, the links and their cost
- The router will select routes based on its lowest cost to get to the destination
- In a multiple area OSPF network, ABRs know the information for each area they are connected to
- When multiple areas are in use, each router has individual routes for each IP subnet in its own aream and sumnmary routes to other areas which go via an ABR

## OSPF Metric Calculation
- For destinations in itws own area, a router looks at all available links to get there, and chooses the path with the lowest overall cost
- For destination in another area, a router looks at all available links to get to the ABR and chooses the path with the lowest overall cost to the ABR. It's then up to the ABR to choose the best path onwards from there.

## SPF Shortest Path First Alogrithm
- The SPF shortest Path First Alogrithm calculates the overall cost for each available path to each destination network, and then selects the lowest cost path
- The overall cost = cumulative cose of all outgoing interfaces
- You should ensure the cost is set the same on the interfaces on both sides of a link or you can get asymmetric routing
- SPF calculates the path on the outgoing interfaces and not the incoming interfaces. Which ever way traffic is being sent is the way it will calculate the cost
- We want to try to have the traffic travel the same path as it is delivered and received

## Reference Bandwidth
- The cost is automatically derived from the interface bandwidth
- Cost = Reference Bandwidth/Interface Bandwidth *divided by
- The default refence bandwidth is 100 Mbps
- FastEthernet link cost default to 1 (100/100)
- 100/1.544 = 64
- OSPF trreats all itnerfaces of 100 Mbps or faster as equal
- FastEthernet, Gigabit Ethernet, 10 Gigabit Ethernet all default to a cost of 1
  - This can cause undesirable routing in modern networks
- We can force a change in the cost by changing the reference bandwidth
- We want to change the reference bandwidth to a higher number because of the Cost formula up above
- The commands are
  - _Router OSPF 1_
  - _auto-cost reference-bandwidth 100000_
  - 
