# The Boot Up Process

## Cisco Device Memory

Cisco routers and switches have 4 built-in memory locations:
- ROM - Read Only Memory
  - When the device is powered on, it will first load from ROM
  - Two main functions are performed
    1. Power On Self Test
    2. Load Bootstrap
  - The botostrap will look in flash for an IOS software image to load
  - If an IOS iamge cannot be found the device will show the ROMMON prompt at the command line
  - ROMMON or ROM Monitor can be used to recover a missing or corrupted software image
  - In this case you can boot from USB or an external TFTP server to recover the device
  - You can also search for ROMMON Recovery for your specific device model, you can find the instructions here.
- Flash - Removable CompactFlash
  - The system will load the first IOS image found in Flash by default
  - You can override this with the _Boot System_ command, to get to a new image
  - You can copy additional IOS system images to Flash via TFTP or USB
  - Use the _Show Flash_ command to view the system image
  - To delete the system image _Delete Flash:"System Image File"_
- NVRAM - Non-Volatile Random Access Memory
  - When the system has finished loading the IOS system image from Flash, it will load the "startup-config" configuration file from NVRAM
  - The saved startup-config becomes the current running-config in RAM
  - If no startup-config file is found, the device will load the Setup Wizard
  - Whenever you enter a command in IOS it takes effect immediately and goes into the "running-config" which is stored in RAM
  - To make change permanent across a reboot:
    - _Copy Running-Config Startup-Config_
    - You can view the startup or running config with the command _Show Start/Show Run_
- RAM - Random Access Memory
  - The IOS system image and startup-config are loaded from Flash and NVRAM into RAM during the bootup
  - RAM is used as the normal working memory of the device
  - ROM, Flash, NVRAM are permanent memory, their contents are not lost when the device is powered off or rebooted
  - RAM is volatile memory, meaning its contents are lost when the deivce is powered off


## Small Considerations

### VLAN Database
The VLAN database represented by vlan.dat, is saved in either Flash or NVRAM. This is dependent on the model of the switch

### Booting from TFTP

The system can also load a system image and/or startup-config from an external TFTP server instead of Flash/NVRAM, but generally this is not recommended because the device will nto be able to boot if it loses connectivity to the server.
It is usually used where the device does not have enough capacity in Flash to save the system image


# Factory Reset and Password Recovery

## Factory Reset

The command to factory reset a router or switch is _Write Erase_.
This command will erase the startup-config, then on a reload of the device it will start up with a blank configuration, and the setup wizard will start

### The Config Register

The configuration register can be used to change the way the router boots
Command _Config-register_ in global configuration mode or _Confreg_ at the rommon prompt

Different ways to set how the router boots with certain codes
  - 0x2102: boot normally (default)
  - 0x2120: boot into romon
  - 0x2142: ignore contents of NVRAM (startup-config)
Example: _Config-Register_ 0x2102

# Enable Secret vs Enable Password

## Enable Secret

When using _Enable Secret_ the password for the device becomes encrypted

## Enable Password

_Enable Password_ is displayed in clear text. When you use the _Show Run_ command it will show you both the secret and the password.
_Enable Secret_ Overrides the Enable Secret

## Router Password Recovery Procedure

If you don't have the enable password go ahead and reboot the device

Press the break sequence (Ctrl-Break/Pause) at power on to break into rommon prompt.

Then confreg 0x2142 to ignore the startup-config on boot

The startup-config is still there with the full configuration inlcuding the unknown enable secret, but the router does not use it when it boots 

Use _Reset_ to reload

The router will bootup with no configuration. Type no to bypass the setup wizard

Enter enable mode. You will not be prompted for the enable secret as it is not in the running configuration

Copy the startup config to the running config
 - This will copy the entire previous configuration into the running config including the unknown enable secret. You are already in enable mode so you do not need to know what the enable secret is

Then enter a new _Enable Secret_ in global configuration mode to overwrite the old one. This will go into the running config

_Config-register 0x2102_ so that the router boots normally on the next restart

_Copy Run Start_ to save the configuration. This will merge the new enable password into the existing startup-config

## Switch Password Recovery Procedure

Very similiar procedure to the router but there are some differences.
Search for 'Cisco Password Recovery' for your model of switch for full instructions


# Backing Up the System Image and Config

- Copies of the device's IOS system image and configuration can be saved to Flash, FTP, TFTP, or USB
- If you copy  config file into the running-config, it will be merged with the currenct configuration
- To replace a conmfiguration, factory reset and then copy the new configuration into the startup-config

Example commands for backing up the image
- copy flash tftp
- copy running-config tftp
- copy startup-config usb

## Copying the Flash to a TFTP Server

- Show Flash
- Then find the flash file we want to copy over
  - <img width="517" height="169" alt="image" src="https://github.com/user-attachments/assets/5abdeddb-fc6f-43d2-be5e-1ae760e6cf0f" />
- Copy Flash TFTP
  - Then it will ask for source filename and the address or name of the tftp server
- Then we double check our TFTP server and see if the file was loaded up correctly

## Backup Copy of Running Config

- Copy Run TFTP
  - This will ask for the address of the tftp server again and what you would like to name the file for the configuration
  - Best practice is to name the file after the date it was made

## Backup Running Config to Flash

- Copy Run Flash
  - Give the running-config file a name
- Show Flash
  - View the Flash configs
- Copy Flash Run

This can be done with Start as well


